---
title: "Week2 Notes.RMD"
output: html_document
Subject: ggplot2 introduction


---
Lattice Plotting System: Intro
```{r Lattice Plotting}

############Lattice plotting system#########


#xyplot:


library(lattice)
library(datasets)

#Simple scatter
xyplot(Ozone~Wind, data=airquality)

#seperated by month

#convert month to factor
airquality <- transform(airquality, Month= factor(Month))
xyplot(Ozone~ Wind | Month, data=airquality,layout= c(5,1))


#Lattice Panel Functions##

#Generate random data
set.seed(10)
x<- rnorm(100)
f <- rep(0:1, each=50)
y <- x + f - f*x + rnorm(100, sd=0.5)
f <- factor(f, labels = c("Group1", "Group2"))

#plot with 2 panels
xyplot( y~x | f, layout= c(2,1))


#Custom panel function (structure)

xyplot(y~x | f, panel= function(x,y,...) {
        panel.xyplot(x,y,...)#first, call the default panel function for xyplot
        panel.abline(h = median(y), lty=2) #add line at median
        panel.lmline(x,y, col=2) #slr line
        
}) 
```



ggplot2 Introduction:

Simple version: qplot
```{r Simple qplot}
######  ggplot2 : qplot#####
library(ggplot2)
str(mpg)



#simple qplot
qplot(displ, hwy, data=mpg, color= drv)#assign different colors by drv

#adding a geom: smooth?
qplot(displ, hwy, data=mpg, geom= c("point", "smooth"))


#histogram
qplot(hwy, data=mpg, fill= drv)#seperate by drv


#Facets: subsets of data indicated by a factor
#var at right hand side determines the cols of the panels
#var at left: determine rows
qplot(displ, hwy, data=mpg, facets= .~drv)
qplot(hwy, data= mpg, facets= drv~.)

```

Basic components of a ggplot

1. A df
2. aesthetic mappings: how data area mapped to color
3. geoms: geometric, e.g. points, lines, shapes
4. facets: for conditional plots (subsetting)
5. stats: statistical transformations like binning, quantiles, smoothing
6. scales: what scale an aesthetic map uses( e.g. male= red)
7. coordinate system


Basic structure for ggplot
```{r }
#Base

#example
g<- ggplot(mpg, aes(displ,hwy))
print(g) #no layers yet

#Assign points
p<- g + geom_point() #save and print ggplot object
print(p)

g+ geom_point() #auto print plot object


#More layers: smooth 
g + geom_point() + geom_smooth(method= "lm")

#More layers: facet (seperate by a factor var)
g + geom_point() + facet_grid(. ~drv) +geom_smooth(method= "lm")


```

Annotation:

Labels: xlab(), ylab(), labs(), ggtitle()
"geom" functions has options to modify

Modifying Aesthetics:
```{r }
#Constant value of colors
g+ geom_point(color= "steelblue", size =4, alpha= 1/2)

#Color seperated by factor variable
g + geom_point(aes(color=drv), size=4, alpha= 1/2)


```
Modifying labels:
```{r }
g + geom_point(aes(color = drv)) + labs(title = "MPG", x= "DISPL", y= "HWY")




```

Customizing the Smooth:
```{r}
g + geom_point(aes(color=drv), size= 2, alpha=1/2)+ geom_smooth(size=4, linetype = 3, method= "lm", se=FALSE)


```

Changing the Theme:
```{r}
g + geom_point(aes(color=drv)) + theme_bw(base_family = "Times")



```


Notes about Axis Limits:
```{r}
testdat <- data.frame(x = 1:100, y=rnorm(100))
testdat[50,2] <-100  ##set outlier
plot(testdat$x, testdat$y, type= "l", ylim=c(-3,3))


g<- ggplot(testdat, aes(x=x, y=y))
g +geom_line()


```
Plotting the variables: Factor + Continuous

So now, how do we plot the relationship between categorical and continuous variables?
Previously, we just seperate the plotting by factor variables(e.g. drive type, or BMI type)
But now we need to seperate them into a factor and a continuous type. Hence, we need to :

Transform continuous into a certain range of factors: using cut() functions


```{r}
#Not able to access the data so just take notes

#Calculate the deciles of the data
cutpoints <- quantile(df$var, seq(0,1, length= 4), na.rm=TRUE)

df$newvar <- cut(df$var, cutpoints)

#see levels
levels(df$newvar)


```

Summary
```{r}

#Base
g<- ggplot(df, aes(x,y))

#Add layer
        g+
        geom_point(...) +
        facet_wrap(var1~ var2, nrow= 2, ncol=4) +
        geom_smooth(method="lm", se=FALSE, col="steelblue") +
        theme_bw(base_family= "Avenir", base_size = 10) +
        labs(title= "", x="", y="")



```